name: 'Integration tests'
on: [push, workflow_call]
jobs:
  test:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Make env file
        uses: SpicyPizza/create-envfile@v2.0
        with:
          envkey_DEBUG: false
          envkey_SOME_API_KEY: "api_key"
          DATABASE_URL: postgresql://root:senha123@database/ecommerce_db
          ACCESS_TOKEN_SECRET: senha
          REFRESH_TOKEN_SECRET: senha
          REDIS_PASSWORD: passforredis
          REDIS_HOST: cache
          REDIS_PORT: 6379
          file_name: ".env.test.local"
          fail_on_empty: false
          directory: .

      - name: 'Run integration tests'
        run: docker compose up integration_tests
